#!/bin/bash

PATH := node_modules/.bin/:${PATH}

dev: src/remora/parser.js src/browser/deps.js 

src/remora/parser.js: src/remora/grammar.pegjs
	pegjs -e "`printf '/* generated from grammar.pegjs */\ngoog.provide("remora.parser");\nremora.parser'`" $< $@

src/browser/deps.js: src/*.js src/remora/*.js
	depswriter.py --root_with_prefix="src/ ../" | \
		sed -e 's/autogenerated by .*/autogenerated by depswriter.py/' \
		> src/browser/deps.js

clean:
	rm src/browser/deps.js
	rm src/remora/parser.js

package:
	mkdir build 2> /dev/null || true
	closure `closurebuilder.py --root src/ --namespace "remora"` > build/package.js

gh-page:
	hg co gh-pages
	hg merge master
	hg ci -m "Merge master -> gh-pages"
	hg co master
	hg push
